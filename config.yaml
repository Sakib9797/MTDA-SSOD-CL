# Configuration for Multi-Target Domain Adaptation Training

# Model Configuration
model:
  size: yolo11s  # Using YOLOv11 small (latest version)
  num_classes: 7
  pretrained: true

# Training Configuration
training:
  epochs: 100  # Total training epochs (100 epochs â‰ˆ 4-6 hours with YOLOv11)
  batch_size: 20  # Increased with more data
  img_size: 640  # Input image size (640x640)
  workers: 8  # Increased data loading workers for faster training
  
  # Optimizer
  optimizer: adamw
  lr: 0.0025  # Further increased for faster convergence
  weight_decay: 0.00002  # Reduced further
  momentum: 0.95
  
  # Learning rate schedule
  scheduler: cosine
  warmup_epochs: 7  # More warmup for stability with higher LR
  min_lr: 0.00005

# Curriculum Learning Configuration
curriculum:
  enabled: true
  stages:
    - name: easy
      epochs_ratio: 0.20  # 20% of total epochs (faster transition)
      domains: [normal]
      domain_weights:
        normal: 1.0
        foggy: 0.0
        rainy: 0.0
      pseudo_label_ratio: 0.4
      confidence_threshold: 0.6
    
    - name: medium
      epochs_ratio: 0.40  # 40% of total epochs (more time in medium)
      domains: [normal, foggy]
      domain_weights:
        normal: 0.75
        foggy: 0.25
        rainy: 0.0
      pseudo_label_ratio: 0.6
      confidence_threshold: 0.4
    
    - name: hard
      epochs_ratio: 0.4  # 40% of total epochs
      domains: [normal, foggy, rainy]
      domain_weights:
        normal: 0.5
        foggy: 0.25
        rainy: 0.25
      pseudo_label_ratio: 0.8
      confidence_threshold: 0.2

# Domain Adaptation Configuration
domain_adaptation:
  enabled: true
  adversarial_training: true
  gradient_reversal_alpha: 2.0
  domain_loss_weight: 0.5
  mmd_loss_weight: 0.2
  feature_alignment: true

# Semi-Supervised Learning Configuration
semi_supervised:
  enabled: true
  pseudo_labeling: true
  confidence_threshold: 0.35
  iou_threshold: 0.4
  consistency_weight: 2.0

# Dataset Configuration
dataset:
  path: dataset
  max_samples_per_split: 500  # Increased further for better learning
  cache: true  # Cache for faster data loading (uses more RAM but speeds up training)
  augmentation:
    hsv_h: 0.025
    hsv_s: 0.8
    hsv_v: 0.55
    degrees: 7.0  # Increased rotation
    translate: 0.18
    scale: 0.75
    shear: 3.0  # Increased shear
    perspective: 0.001
    flipud: 0.0
    fliplr: 0.5
    mosaic: 1.0
    mixup: 0.2  # Increased mixup

# Evaluation Configuration
evaluation:
  conf_threshold: 0.001
  iou_threshold: 0.5  # Adjusted for better mAP calculation
  
# Performance Optimization
performance:
  mixed_precision: true  # Use FP16 for faster training
  compile_model: false  # torch.compile (requires PyTorch 2.0+)
  gradient_accumulation: 1  # Set to 2-4 if batch size needs reduction
  max_norm_clip: 10.0  # Gradient clipping for stability
  max_detections: 300
  save_predictions: true

# Output Configuration
output:
  dir: runs/train
  save_period: 10  # Save checkpoint every N epochs
  save_best: true
  save_last: true
  log_interval: 10  # Log every N batches

# Hardware Configuration
hardware:
  device: auto  # Options: auto, cuda, cpu
  mixed_precision: true  # Use automatic mixed precision for faster training
  cudnn_benchmark: true

# Classes
classes:
  - person
  - car
  - truck
  - bus
  - train
  - motorcycle
  - bicycle

# Domain Information
domains:
  - name: normal
    description: "Clear weather conditions"
    difficulty: easy
  
  - name: foggy
    description: "Foggy weather conditions"
    difficulty: medium
  
  - name: rainy
    description: "Rainy weather conditions"
    difficulty: hard
